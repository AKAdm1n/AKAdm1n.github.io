<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Whitelist Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
    <div class="container">
        <h1>Whitelist Management</h1>
        <input type="text" id="username" placeholder="Enter username" class="form-control" />
        <button id="addButton" class="btn btn-primary">Add to Whitelist</button>
        <button id="removeButton" class="btn btn-danger">Remove from Whitelist</button>
        <button id="downloadButton" class="btn btn-success">Download Whitelist</button>
        <button id="combineDownloadButton" class="btn btn-info">Combine Download</button>

        <h2>Current Whitelisted Users</h2>
        <ul id="whitelistUsers" class="list-group"></ul>
    </div>

    <script>
        const whitelistUsers = document.getElementById('whitelistUsers');
        const usernameInput = document.getElementById('username');
        const baseURL = 'https://b9147066-c15a-4ff8-aa2e-0c3587462bab-00-3taxu2quvjj99.janeway.replit.dev/whitelist';

        // Fetch the whitelist from the Node.js server
        const fetchWhitelist = () => {
            fetch(baseURL)
                .then(response => {
                    if (!response.ok) throw new Error('Failed to fetch whitelist');
                    return response.json();
                })
                .then(data => {
                    whitelistUsers.innerHTML = ''; // Clear the existing list
                    data.forEach(user => {
                        const li = document.createElement('li');
                        li.textContent = user;
                        whitelistUsers.appendChild(li);
                    });
                })
                .catch(error => {
                    console.error(error);
                    alert('Error fetching whitelist: ' + error.message);
                });
        };

        // Initial fetch of the whitelist
        fetchWhitelist();

        // Add username to whitelist
        document.getElementById('addButton').onclick = () => {
            const username = usernameInput.value.trim();
            if (username) {
                fetch(baseURL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username })
                })
                .then(response => {
                    if (response.ok) {
                        const li = document.createElement('li');
                        li.textContent = username;
                        whitelistUsers.appendChild(li);
                        usernameInput.value = '';
                    } else {
                        alert('Failed to add user to whitelist');
                    }
                })
                .catch(error => {
                    console.error(error);
                    alert('Error adding user: ' + error.message);
                });
            }
        };

         // Remove username from whitelist
document.getElementById('removeButton').onclick = () => {
    const username = usernameInput.value.trim();
    if (username) {
        fetch('https://b9147066-c15a-4ff8-aa2e-0c3587462bab-00-3taxu2quvjj99.janeway.replit.dev/whitelist', {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ username }) // Include username in body
        })
        .then(response => {
            if (response.ok) {
                const li = Array.from(whitelistUsers.children).find(item => item.textContent === username);
                if (li) {
                    whitelistUsers.removeChild(li); // Remove user from the displayed list
                }
                usernameInput.value = ''; // Clear input
            } else {
                alert('Failed to remove user from whitelist: ' + response.statusText);
            }
        })
        .catch(error => {
            console.error('Error removing user:', error); // Log error for debugging
            alert('Error removing user: ' + error.message);
        });
    }
};


        // Download whitelist as a Lua table
        document.getElementById('downloadButton').onclick = () => {
            fetch(baseURL)
                .then(response => response.json())
                .then(users => {
                    const luaContent = `local whitelistedPlayers = {\n${users.map(user => `  "${user}",`).join('\n')}\n}`; // Create Lua content
                    const blob = new Blob([luaContent], { type: 'text/plain' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'whitelistedPlayers.txt'; // The name of the downloaded file
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                })
                .catch(error => {
                    console.error(error);
                    alert('Error downloading whitelist: ' + error.message);
                });
        };

        // Combine Download button
        document.getElementById('combineDownloadButton').onclick = async () => {
            // Fetch the existing content from the specified URL
            const response = await fetch('https://cdn.discordapp.com/attachments/781966227157286924/1290482994531799070/combinedFile.txt?ex=66fc9f71&is=66fb4df1&hm=ba5162ecf6031e9fb5bbef5f7947a2f234e198f4b04dd6d81d6f45935c960b85&');
            const existingContent = await response.text(); // Get the text of the existing content

            // Fetch the current whitelist
            const whitelistResponse = await fetch(baseURL);
            const users = await whitelistResponse.json();

            // Create the Lua table
            const luaTable = `local whitelistedPlayers = {\n${users.map(user => `  "${user}",`).join('\n')}\n}\n\n`;

            // Combine the Lua table with the existing content
            const combinedContent = luaTable + existingContent;

            // Create a blob and download the combined content
            const blob = new Blob([combinedContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'combinedWhitelist.txt'; // The name of the downloaded file
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>
